<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Inform 7 - 11.6. Ending The Story</title>
</head>
<body>
<div style="line-height: 18px;">

<!-- SEARCH TITLE "Labyrinth of Ghosts" -->
<!-- SEARCH SECTION "Ex 430" -->
<!-- SEARCH SORT "Ex 011-006-430" -->
<font><table><tr width="100%"><td width=80 valign="top"><a href=doc95.html border=0><img border=0 src=images/Back.png border=0></a><a href=Rindex.html border=0><img border=0 src=images/Home.png border=0></a><a href=doc97.html border=0><img border=0 src=images/Forward.png border=0></a></td><td valign="top"><b>11.6. Ending The Story</b></td></tr></table><p>
<p>
<p>Play can end in many ways, at the writer's discretion:
<p>
<blockquote><font color="#000080">end the story;
<br>end the story finally;
<br>end the story saying &quot;You have reached an impasse, a stalemate&quot;;
<br>end the story finally saying &quot;You have succeeded.&quot;;
</font></blockquote><p>
<p>
<p>The phrase &quot;end the story&quot; by itself will finish play, printing &quot;*** The End ***&quot;. Using one of the phrases with &quot;saying...&quot; allows us to specify some other text with which to conclude. Including &quot;finally&quot; means that the player has earned access to AMUSING text and other notes, if any of these are provided.
<p>
<p>We can eliminate the asterisked headline entirely by removing the rule that prints it, thus:
<p>
<blockquote><font color="#000080">The print obituary headline rule is not listed in any rulebook.
</font></blockquote><p>
<p>
<p>The next step is to print the player's score and, if applicable, the rank he achieved. If there is no score in the game, we can prevent a score being listed here with
<p>
<blockquote><font color="#000080">Use no scoring.
</font></blockquote><p>
<p>
<p>Or, if we want to allow a score but alter the way it is reported, we may remove or modify the print final score rule, as in
<p>
<blockquote><font color="#000080">The print final score rule is not listed in any rulebook.
</font></blockquote><p>
<p>
<p>or perhaps something like
<p>
<blockquote><font color="#000080">The chatty final score rule is listed instead of the print final score rule in for printing the player's obituary.
</font></blockquote><p>
<p>
<blockquote><font color="#000080">This is the chatty final score rule: say &quot;Wow, you achieved a whole [score in words] point[s] out of a possible [maximum score in words]! I'm very proud of you. This was a triumph. I'm being so sincere right now.&quot;
</font></blockquote><p>
<p>
<p>What happens next is normally that the player is invited to RESTART, RESTORE (from a saved game), QUIT or UNDO the last command. The presence of the question can somewhat undercut a tragedy, and <b>Battle of Ridgefield</b> shows another way to go out.
<p>
<p>If we do leave the question in, the text is formed by the Table of Final Question Options, which by default looks like this:
<p>
<blockquote><font color="#000080">Table of Final Question Options
<br><table border="0" valign="top" cellpadding="0" cellspacing="0"><tr><td valign="top"><font color="#000080">final question wording</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">only if victorious</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">topic</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">final response rule</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">final response activity</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">&quot;RESTART&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">false</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">&quot;restart&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">immediately restart the VM rule</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">--</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">&quot;RESTORE a saved game&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">false</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">&quot;restore&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">immediately restore saved game rule</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">--</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">&quot;see some suggestions for AMUSING things to do&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">true</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">&quot;amusing&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">--</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">amusing a victorious player</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">&quot;QUIT&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">false</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">&quot;quit&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">immediately quit rule</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">--</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">&quot;UNDO the last command&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">false</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">&quot;undo&quot;</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">immediately undo rule</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">--</font>&nbsp;&nbsp;&nbsp;</td>
</tr></table>
</font></blockquote><p>
<p>
<p>Because this is a table, we may alter the behavior by changing entries or continuing the table. <b>Finality</b> shows how we might take out the option to UNDO the last command, for instance.
<p>
<p>Using an ending phrase that includes &quot;finally&quot; tells Inform to include the options that are marked &quot;only if victorious&quot;. One common use is to let the player read some special bit of additional text, perhaps describing easter eggs he might have missed in the story or presenting some authorial notes. <b>Xerxes</b> demonstrates a simple AMUSING command to read final information, while <b>Jamaica 1688</b> shows how to add completely new elements to the list of options.
<p>
<p>Old-school adventures expected their adventurers to die early and die often. <b>Labyrinth of Ghosts</b> shows how the residue of such past attempts can be preserved into subsequent attempts, using an external file. <b>Big Sky Country</b> shows how a player can be resurrected by, let us say, some beneficent god, so that a player can even die more than once in the same attempt.
<p>
<p><hr><p>
<a name="e125"><a href=Rex125.html#e125 STYLE="text-decoration: none">*<b>Example 369:  Battle of Ridgefield</b></a><br>Completely replacing the endgame text and stopping the game without giving the player a chance to restart or restore.<p>
<a name="e143"><a href=Rex143.html#e143 STYLE="text-decoration: none">*<b>Example 370:  Finality</b></a><br>Not mentioning UNDO in the final set of options.<p>
<a name="e9"><a href=Rex9.html#e9 STYLE="text-decoration: none">**<b>Example 372:  Xerxes</b></a><br>Offering the player a menu of things to read after winning the game.<p>
<a name="e200"><a href=Rex200.html#e200 STYLE="text-decoration: none">*<b>Example 371:  Jamaica 1688</b></a><br>Adding a feature to the final question after victory, so that the player can choose to reveal notes about items in the game.<p>
<!-- EXAMPLE START -->
<a name="e208"><a href=Rdoc96.html#e208 STYLE="text-decoration: none">**<b><b>Example</b> 430:  Labyrinth of Ghosts</b></a><br>Remembering the fates of all previous explorers of the labyrinth.<p>
<table border=0 bgcolor="#ffffc0" width=100%><tr><td><font>
<p>
<p>A tradition among Nethack-like computer games of the old school is that a player's death in a given place leaves a ghost behind to haunt subsequent players. Information about past lives is sometimes stored in a &quot;bones file&quot;, and in this example we do exactly that, for a grievously unfair little dungeon.
<p>
<p>To begin with, the labyrinth itself. We create a kind of value to remember possible means of death in these tunnels, and we assign a coordinate position in some grid to each location. (We do this because grid positions can safely be stored in tables saved out to external files, whereas room names cannot - they represent data which changes each time we amend the source.)
<p>
<blockquote><font color="#000080">&quot;Labyrinth of Ghosts&quot;
</font></blockquote><p>
<p>
<blockquote><font color="#000080">A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.
</font></blockquote><p>
<p>
<blockquote><font color="#000080">A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.
</font></blockquote><p>
<p>
<blockquote><font color="#000080">The Gateway is a room. &quot;For the foolhardy adventurer, the perilous labyrinth lies north, east or south.&quot; The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. &quot;This partly fallen cave may perhaps extend further north.&quot; The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. &quot;No telling why this canyon is named after archery, but perhaps if you wait around you'll find out.&quot; The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.
</font></blockquote><p>
<p>
<blockquote><font color="#000080">Every turn when a random chance of 1 in 10 succeeds:
<br>&nbsp;&nbsp;&nbsp;&nbsp;say &quot;A dwarf appears out of nowhere, and throws a nasty little knife.&quot;;
<br>&nbsp;&nbsp;&nbsp;&nbsp;have the player slain.
</font></blockquote><p>
<p>
<p>And as compensation for these hazards:
<p>
<blockquote><font color="#000080">Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.
</font></blockquote><p>
<p>
<blockquote><font color="#000080">Table of Point Values
<br>item 	  	score
<br><table border="0" valign="top" cellpadding="0" cellspacing="0"><tr><td valign="top"><font color="#000080">silver bars</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">3</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">platinum pyramid</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">10</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">emerald</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">4</font>&nbsp;&nbsp;&nbsp;</td>
</tr></table>
</font></blockquote><p>
<p>
<blockquote><font color="#000080">Report taking an item listed in the Table of Point Values:
<br>&nbsp;&nbsp;&nbsp;&nbsp;increase the score by the score entry;
<br>&nbsp;&nbsp;&nbsp;&nbsp;blank out the whole row.
</font></blockquote><p>
<p>
<p>We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.
<p>
<blockquote><font color="#000080">Table of Ghostly Presences
<br><table border="0" valign="top" cellpadding="0" cellspacing="0"><tr><td valign="top"><font color="#000080">haunted position</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">score at death</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">turns at death</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">manner of death</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">sequence</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">a grid location</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">a number</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">a number</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">a demise</font>&nbsp;&nbsp;&nbsp;</td><td valign="top"><font color="#000080">a number</font>&nbsp;&nbsp;&nbsp;</td>
</tr><tr><td valign="top"><font color="#000080">with 19 blank rows.</font>&nbsp;&nbsp;&nbsp;</td>
</tr></table>
</font></blockquote><p>
<p>
<p>As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.
<p>
<blockquote><font color="#000080">The File of Ghosts is called &quot;ghosts&quot;.
</font></blockquote><p>
<p>
<blockquote><font color="#000080">When play begins:
<br>&nbsp;&nbsp;&nbsp;&nbsp;if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;
<br>&nbsp;&nbsp;&nbsp;&nbsp;sort the Table of Ghostly Presences in sequence order.
</font></blockquote><p>
<p>
<p>How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...
<p>
<blockquote><font color="#000080">After looking:
<br>&nbsp;&nbsp;&nbsp;&nbsp;repeat through the Table of Ghostly Presences in reverse sequence order:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if the haunted position entry is the coordinates of the location, say &quot;You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.&quot;
</font></blockquote><p>
<p>
<p>(For instance, &quot;You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.&quot;) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)
<p>
<blockquote><font color="#000080">To have the player (sticky end - a demise):
<br>&nbsp;&nbsp;&nbsp;&nbsp;let the new sequence number be 0;
<br>&nbsp;&nbsp;&nbsp;&nbsp;repeat through the Table of Ghostly Presences:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let S be the sequence entry;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if S is greater than the new sequence number, let the new sequence number be S;
<br>&nbsp;&nbsp;&nbsp;&nbsp;increment the new sequence number;
<br>&nbsp;&nbsp;&nbsp;&nbsp;if the number of blank rows in the Table of Ghostly Presences is 0:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choose row 1 in the Table of Ghostly Presences;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blank out the whole row;
<br>&nbsp;&nbsp;&nbsp;&nbsp;choose a blank row in the Table of Ghostly Presences;
<br>&nbsp;&nbsp;&nbsp;&nbsp;now the sequence entry is the new sequence number;
<br>&nbsp;&nbsp;&nbsp;&nbsp;now the manner of death entry is the sticky end;
<br>&nbsp;&nbsp;&nbsp;&nbsp;now the turns at death entry is the turn count;
<br>&nbsp;&nbsp;&nbsp;&nbsp;now the score at death entry is the score;
<br>&nbsp;&nbsp;&nbsp;&nbsp;now the haunted position entry is the coordinates of the location;
<br>&nbsp;&nbsp;&nbsp;&nbsp;write the File of Ghosts from the Table of Ghostly Presences;
<br>&nbsp;&nbsp;&nbsp;&nbsp;now the latest demise is the sticky end;
<br>&nbsp;&nbsp;&nbsp;&nbsp;end the story saying &quot;You have been [latest demise]&quot;.
</font></blockquote><p>
<p>
<p>Strictly speaking we ought to worry that after 2,147,483,647 deaths, the sequence numbers would grow too large to store in a single value, and then the sequence of ghosts will be erratic. But it seems unlikely that anyone will play this example 2.1 billion times.
</td></tr></table><p>
<!-- EXAMPLE END -->
<a name="e202"><a href=Rex202.html#e202 STYLE="text-decoration: none">***<b>Example 138:  Big Sky Country</b></a><br>Allowing the player to continue play after a fatal accident, but penalizing him by scattering his possessions around the game map.<p>
<p><hr><p><a href=Rdoc95.html STYLE="text-decoration: none">Previous</a> / <a href=Rdoc97.html STYLE="text-decoration: none">Next</a> / <a href=Rindex.html STYLE="text-decoration: none">Contents</a><p></font></div>
</body>
</html>
